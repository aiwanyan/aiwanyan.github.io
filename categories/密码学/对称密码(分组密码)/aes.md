# aes加密:

## 1.特征:

| 属性              | 说明                                                |
| ----------------- | --------------------------------------------------- |
| 分组大小（Block） | 固定为 **128 位**（16 字节）                        |
| 密钥长度（Key）   | 可为 **128 位 / 192 位 / 256 位**（常用128位）      |
| 轮数（Rounds）    | 依据密钥长度不同：10（128位）、12（192）、14（256） |
| 算法结构          | 基于 **Substitution–Permutation Network（SPN）**    |

## 2.aes的加密流程 (密钥128位):

``` AES
输入明文（128bit）
      ↓
AddRoundKey（初始轮）
      ↓
9轮：SubBytes(字节代换) → ShiftRows(行移位) → MixColumns(列混合) → AddRoundKey (轮密钥加)
      ↓
第10轮：SubBytes → ShiftRows → AddRoundKey    ---没有列混合
      ↓
输出密文（128bit）

```

3.初始轮:

``` aes
将明文状态矩阵与第 0 轮子密钥（RoundKey₀）做逐字节异或（XOR）操作。
本质上是将密钥“注入”到加密流程的起点，为接下来的非线性变换和扩散做准备。
```

### 1.问题:

明文是 128 位（16 字节），初始轮的 AddRoundKey 是对明文和密钥逐字节 XOR。如果我的密钥是 **192 位或 256 位**，那怎么 XOR 呢？

``` aes
AES 不直接使用原始密钥参与加密，而是通过 密钥扩展（Key Schedule） 生成 每轮使用的“轮密钥”（Round Key）。不管原始密钥是 128、192 还是 256 位，每轮都只用一个 128 位的轮密钥。
```

| 原始密钥位数 | 总轮数 | 要生成的子密钥数量 | 每个子密钥长度    |
| ------------ | ------ | ------------------ | ----------------- |
| 128 位       | 10     | 11 个              | 128 位（16 字节） |
| 192 位       | 12     | 13 个              | 128 位            |
| 256 位       | 14     | 15 个              | 128 位            |

## 4.字节替代(s盒):

``` aes
对 状态矩阵中的每个字节，使用一个固定的查找表（S-box）进行非线性映射替代
是整个 AES 中引入非线性和抗线性分析攻击的核心步骤
就是按字节查表:
   比如某一个字节是0x53
        高4位：5（行索引）
        低4位：3（列索引）
   然后去s盒表中找5行3列对应的字节值
```

## 5.行移位:

按行左移字节就行了

| 行号  | 操作                           |
| ----- | ------------------------------ |
| 第0行 | 不变                           |
| 第1行 | 循环左移 1 个字节              |
| 第2行 | 循环左移 2 个字节              |
| 第3行 | 循环左移 3 个字节（或右移1位） |

``` aes
打乱同一列字节之间的联系，让后续的 MixColumns 可以混合更多跨字节的数据；
增强扩散性，使得明文的小改动能影响到加密后的多个字节；
是一种 位置置换操作，没有改变字节本身的值。
```

## 6.列混合:

``` aes
MixColumns（列混合） 是 AES 加密中每一轮的第 3 个操作（除了最后一轮不执行它），
它通过矩阵乘法在 GF(2⁸) 有限域中，把每一列的4个字节混合生成新的4个字节。
```

## 7.轮密钥加:

``` aes
当前状态矩阵与本轮的轮密钥（Round Key）逐字节进行按位异或（XOR）
```

| 特性       | 说明                                      |
| ---------- | ----------------------------------------- |
| 运算简单   | 仅使用按位异或（XOR），硬件友好           |
| 密钥注入点 | 是 AES 中 **唯一使用密钥的地方**          |
| 可逆性强   | XOR 的逆运算就是本身（再次 XOR 即可还原） |
| 轮密钥变化 | 每轮使用不同的轮密钥（由原始密钥扩展）    |

## 8.密钥扩展:

``` aes
将原始密钥切成若干 32 位字（4字/6字/8字）
每次迭代扩展一个 32 位字，共需 44/52/60 个字（每轮 4 个字）

1. 初始密钥写入前 Nk 个字（Nk = 4/6/8）
2. 对后续每一组（每组4字）：
   - 如果当前索引 i 是 Nk 的倍数：
     temp = SubWord(RotWord(w[i-1])) ⊕ Rcon[i/Nk]
   - 否则如果 Nk > 6 且 i ≡ 4 mod Nk：
     temp = SubWord(w[i-1])
   - 然后：w[i] = w[i-Nk] ⊕ temp

```

| 项目         | AES                           | DES                    | SM4                         |
| ------------ | ----------------------------- | ---------------------- | --------------------------- |
| 原始密钥长度 | 128 / 192 / 256 bit           | 64 bit（含8位校验）    | 128 bit                     |
| 有效密钥长度 | 128 / 192 / 256 bit           | 56 bit                 | 128 bit                     |
| 总轮数       | 10 / 12 / 14                  | 16                     | 32                          |
| 每轮密钥长度 | 128 bit（16 字节）            | 48 bit                 | 32 bit（1个字）             |
| 子密钥数量   | 轮数 + 1（11/13/15 个）       | 16 个                  | 32 个                       |
| 主要操作     | 字扩展 + S-box + XOR + 轮常量 | 置换 + 左移 + 压缩置换 | XOR + S-box + 线性变换 + CK |
| 是否非线性   | ✅（使用 S-box）               | ❌                      | ✅（S-box + 线性组合）       |
| 是否可逆     | ❌                             | ✅                      | ❌（但结构对称）             |
